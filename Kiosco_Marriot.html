<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marriott - Check-in Express</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind immediately
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'marriott-red': '#a11d2b',
                        'marriott-dark': '#7d1722',
                        'marriott-light': '#c92a3a',
                        'gray-soft': '#F8F9FA',
                        'text-primary': '#2C3E50',
                        'text-secondary': '#6C757D'
                    }
                }
            }
        };
    </script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        @keyframes scan {
            0% { transform: translateY(0); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(200px); opacity: 0; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulseSoft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .scan-animation {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #a11d2b, transparent);
            animation: scan 2s ease-in-out;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
        }
        
        /* Hide scrollbar but keep functionality */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* Professional transitions */
        .transition-professional {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* QR Code Style */
        .qr-container {
            background: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .qr-pattern {
            width: 150px;
            height: 150px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cpath fill='%23000' d='M10 10h30v30H10zm40 0h10v10H50zm10 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h30v30h-30zm40 0h10v10h-10zm10 0h30v30h-30zM10 40h10v10H10zm20 0h10v10H30zm70 0h10v10h-10zm30 0h10v10h-10zm30 0h10v10h-10zM10 50h30v30H10zm40 0h10v10H50zm10 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h30v30h-30zm40 0h30v30h-30zM40 80h10v10H40zm10 0h10v10H50zm10 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zM10 90h10v10H10zm20 0h10v10H30zm20 0h10v10H50zm20 0h10v10H70zm20 0h10v10H90zm20 0h10v10h-10zm20 0h10v10h-10zm20 0h10v10h-10zm30 0h10v10h-10zM10 100h10v10H10zm10 0h10v10H20zm10 0h10v10H30zm10 0h10v10H40zm10 0h10v10H50zm10 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zm10 0h10v10h-10zM10 110h30v30H10zm50 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h30v30h-30zm40 0h10v10h-10zm10 0h30v30h-30zM10 140h10v10H10zm20 0h10v10H30zm70 0h10v10h-10zm30 0h10v10h-10zm30 0h10v10h-10zM10 150h30v30H10zm40 0h10v10H50zm10 0h10v10H60zm10 0h10v10H70zm10 0h10v10H80zm10 0h10v10H90zm10 0h30v30h-30zm40 0h30v30h-30z'/%3E%3C/svg%3E");
            background-size: contain;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Main Container -->
    <div class="max-w-xl mx-auto min-h-screen bg-white shadow-xl relative">
        
        <!-- Header -->
        <header class="glass-effect border-b border-gray-100 px-6 py-4 sticky top-0 z-50">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <!-- Marriott Logo -->
                    <div class="w-10 h-10 bg-marriott-red rounded-lg flex items-center justify-center text-white font-bold text-xl">
                        M
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold text-gray-900">Marriott Hotels</h1>
                        <p class="text-xs text-gray-500">Check-in Express</p>
                    </div>
                </div>
                <!-- Timer Badge -->
                <div id="timerBadge" class="hidden px-3 py-1.5 bg-gray-100 rounded-full">
                    <span class="text-sm font-mono text-gray-600" id="timerDisplay">00:00</span>
                </div>
            </div>
        </header>

        <!-- Content Container -->
        <main class="relative pb-32">
            
            <!-- Step 1: Welcome -->
            <div id="step1" class="p-6 animate-fade-in">
                <!-- Progress Indicator -->
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-marriott-red text-white rounded-full flex items-center justify-center text-sm font-semibold">1</div>
                        <div class="w-20 h-0.5 bg-gray-200"></div>
                        <div class="w-8 h-8 bg-gray-200 text-gray-400 rounded-full flex items-center justify-center text-sm">2</div>
                        <div class="w-20 h-0.5 bg-gray-200"></div>
                        <div class="w-8 h-8 bg-gray-200 text-gray-400 rounded-full flex items-center justify-center text-sm">3</div>
                    </div>
                    <span class="text-xs text-gray-500">Paso 1 de 3</span>
                </div>

                <!-- Welcome Content -->
                <div class="text-center py-8">
                    <!-- Hotel Logo -->
                    <div class="flex justify-center mb-6">
                        <img src="logo.png" alt="Marriott Hotels Logo" class="h-16 w-auto sm:h-20 object-contain">
                    </div>
                    
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Bienvenido</h2>
                    <p class="text-gray-600 mb-8">Check-in rápido y sin contacto</p>
                    
                    <!-- Main Check-in Button -->
                    <button onclick="startCheckIn()" class="w-full mb-4 bg-marriott-red hover:bg-marriott-dark text-white font-semibold py-4 px-8 rounded-xl transition-professional transform hover:scale-[1.02] active:scale-[0.98]">
                        <span class="flex items-center justify-center space-x-2">
                            <i data-feather="log-in" class="w-5 h-5"></i>
                            <span>Iniciar Check-in</span>
                        </span>
                    </button>
                    
                    <!-- QR Alternative -->
                    <div class="relative">
                        <div class="flex items-center my-6">
                            <div class="flex-1 h-px bg-gray-200"></div>
                            <span class="px-3 text-sm text-gray-500">o</span>
                            <div class="flex-1 h-px bg-gray-200"></div>
                        </div>
                        
                        <button onclick="showQRScanner()" class="w-full py-3 px-6 border-2 border-gray-200 hover:border-marriott-red text-gray-700 hover:text-marriott-red rounded-xl transition-professional">
                            <span class="flex items-center justify-center space-x-2">
                                <i data-feather="camera" class="w-5 h-5"></i>
                                <span>Escanear código QR</span>
                            </span>
                        </button>
                    </div>
                </div>

                <!-- Features -->
                <div class="mt-8 space-y-3">
                    <div class="flex items-start space-x-3 text-sm">
                        <div class="w-5 h-5 rounded-full bg-green-100 flex-shrink-0 flex items-center justify-center mt-0.5">
                            <i data-feather="check" class="w-3 h-3 text-green-600"></i>
                        </div>
                        <span class="text-gray-600">Proceso completado en menos de 60 segundos</span>
                    </div>
                    <div class="flex items-start space-x-3 text-sm">
                        <div class="w-5 h-5 rounded-full bg-green-100 flex-shrink-0 flex items-center justify-center mt-0.5">
                            <i data-feather="check" class="w-3 h-3 text-green-600"></i>
                        </div>
                        <span class="text-gray-600">Llave digital disponible inmediatamente</span>
                    </div>
                    <div class="flex items-start space-x-3 text-sm">
                        <div class="w-5 h-5 rounded-full bg-green-100 flex-shrink-0 flex items-center justify-center mt-0.5">
                            <i data-feather="check" class="w-3 h-3 text-green-600"></i>
                        </div>
                        <span class="text-gray-600">Datos protegidos y seguros</span>
                    </div>
                </div>
            </div>

            <!-- Step 2: QR Scanner (Hidden initially) -->
            <div id="step2" class="hidden p-6">
                <!-- Progress Indicator -->
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm">
                            <i data-feather="check" class="w-4 h-4"></i>
                        </div>
                        <div class="w-20 h-0.5 bg-green-500"></div>
                        <div class="w-8 h-8 bg-marriott-red text-white rounded-full flex items-center justify-center text-sm font-semibold animate-pulse-soft">2</div>
                        <div class="w-20 h-0.5 bg-gray-200"></div>
                        <div class="w-8 h-8 bg-gray-200 text-gray-400 rounded-full flex items-center justify-center text-sm">3</div>
                    </div>
                    <span class="text-xs text-gray-500">Paso 2 de 3</span>
                </div>

                <!-- QR Scanner Interface -->
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">Escaneando código QR</h2>
                    <p class="text-gray-600 mb-6">Procesando tu reserva...</p>
                    
                    <div class="relative mx-auto w-48 h-48 mb-6">
                        <div class="qr-container relative overflow-hidden">
                            <div class="qr-pattern opacity-20"></div>
                            <div id="scanLine" class="scan-animation"></div>
                        </div>
                    </div>
                    
                    <!-- Loading indicator -->
                    <div class="flex items-center justify-center space-x-2 mb-6">
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                </div>

                <!-- Data Preview (Hidden initially, shown after scan) -->
                <div id="dataPreview" class="hidden animate-slide-up">
                    <div class="bg-gray-soft rounded-xl p-4 mb-6">
                        <h3 class="font-semibold text-gray-900 mb-3">Datos de reserva detectados</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Código de reserva:</span>
                                <span class="font-mono font-semibold">MAR-2024-7635</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Huésped:</span>
                                <span class="font-semibold">Carlos Mendoza</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Check-in:</span>
                                <span class="font-semibold">Hoy, 15:00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Check-out:</span>
                                <span class="font-semibold">04 Nov, 12:00</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Habitación:</span>
                                <span class="font-semibold">Suite Ejecutiva</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="confirmCheckIn()" class="w-full bg-marriott-red hover:bg-marriott-dark text-white font-semibold py-4 px-8 rounded-xl transition-professional transform hover:scale-[1.02] active:scale-[0.98]">
                        Confirmar Check-in
                    </button>
                    
                    <button onclick="resetToStart()" class="w-full mt-3 py-3 text-gray-600 hover:text-gray-900 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>

            <!-- Step 3: Digital Key -->
            <div id="step3" class="hidden p-6">
                <!-- Progress Indicator -->
                <div class="flex items-center justify-between mb-8">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm">
                            <i data-feather="check" class="w-4 h-4"></i>
                        </div>
                        <div class="w-20 h-0.5 bg-green-500"></div>
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm">
                            <i data-feather="check" class="w-4 h-4"></i>
                        </div>
                        <div class="w-20 h-0.5 bg-green-500"></div>
                        <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-sm animate-pulse-soft">
                            <i data-feather="check" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <span class="text-xs text-gray-500">Completado</span>
                </div>

                <!-- Success Message -->
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-feather="check-circle" class="w-8 h-8 text-green-600"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-900 mb-2">¡Check-in Completado!</h2>
                    <p class="text-gray-600">Tu habitación está lista</p>
                </div>

                <!-- Room Card -->
                <div class="bg-gradient-to-br from-gray-900 to-gray-700 text-white rounded-2xl p-6 mb-6 shadow-lg">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <p class="text-gray-300 text-xs uppercase tracking-wider mb-1">Habitación</p>
                            <p class="text-3xl font-bold">512</p>
                        </div>
                        <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center">
                            <i data-feather="key" class="w-6 h-6"></i>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm">
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Tipo</p>
                            <p class="font-semibold">Suite Ejecutiva</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-xs mb-1">Piso</p>
                            <p class="font-semibold">5° Piso</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-xs text-gray-300">Llave digital activa</span>
                        </div>
                    </div>
                </div>

                <!-- Digital Key Actions -->
                <div class="space-y-3 mb-6">
                    <button onclick="sendToPhone()" class="w-full bg-marriott-red hover:bg-marriott-dark text-white font-semibold py-3 px-6 rounded-xl transition-professional flex items-center justify-center space-x-2">
                        <i data-feather="smartphone" class="w-5 h-5"></i>
                        <span>Enviar al móvil</span>
                    </button>
                    
                    <button onclick="printCard()" class="w-full bg-white hover:bg-gray-50 text-gray-700 border-2 border-gray-200 font-semibold py-3 px-6 rounded-xl transition-professional flex items-center justify-center space-x-2">
                        <i data-feather="printer" class="w-5 h-5"></i>
                        <span>Imprimir tarjeta</span>
                    </button>
                </div>

                <!-- Completion Stats -->
                <div class="bg-gray-soft rounded-xl p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <i data-feather="clock" class="w-4 h-4 text-gray-500"></i>
                            <span class="text-sm text-gray-600">Tiempo total:</span>
                        </div>
                        <span class="font-semibold text-green-600" id="totalTime">32 segundos</span>
                    </div>
                </div>

                <!-- New Check-in Button -->
                <button onclick="resetToStart()" class="w-full py-3 text-gray-600 hover:text-gray-900 transition-colors text-center">
                    Realizar nuevo check-in
                </button>
            </div>

        </main>

        <!-- Chat Button (Fixed at Bottom) -->
        <div class="fixed bottom-12 left-0 right-0 px-6 py-4 bg-white border-t border-gray-100 max-w-xl mx-auto">
            <button id="chatButton" onclick="toggleChat()" class="w-full bg-marriott-red hover:bg-marriott-dark text-white font-semibold py-3 px-6 rounded-xl transition-professional flex items-center justify-center space-x-2 group">
                <i data-feather="message-circle" class="w-5 h-5 group-hover:scale-110 transition-transform"></i>
                <span>Asistente Virtual</span>
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse ml-1"></span>
            </button>
        </div>

        <!-- Footer (Fixed at Bottom) -->
        <footer class="fixed bottom-0 left-0 right-0 border-t border-gray-100 px-6 py-3 bg-white max-w-xl mx-auto">
            <div class="flex items-center justify-between text-xs text-gray-500">
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span>Sistema activo</span>
                </div>
                <span>v2.0 Professional</span>
            </div>
        </footer>

        <!-- Chat Window (Hidden by default) -->
        <div id="chatWindow" class="hidden fixed bottom-24 left-1/2 transform -translate-x-1/2 w-full max-w-md mx-4 bg-white rounded-2xl shadow-2xl overflow-hidden z-50 animate-slide-up">
            <!-- Chat Header -->
            <div class="bg-marriott-red text-white px-4 py-3 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
                        <i data-feather="headphones" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <p class="font-semibold text-sm">Asistente Virtual</p>
                        <p class="text-xs opacity-75">En línea</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="hover:bg-white/20 rounded-lg p-1.5 transition-colors">
                    <i data-feather="x" class="w-4 h-4"></i>
                </button>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatMessages" class="h-80 overflow-y-auto p-4 space-y-3 hide-scrollbar">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-semibold text-gray-600">AI</div>
                    <div class="bg-gray-100 rounded-xl rounded-tl-none px-3 py-2 max-w-[80%]">
                        <p class="text-sm text-gray-700">Hola, soy tu asistente de check-in. Pregúntame horarios, recomendaciones y dudas generales.</p>
                    </div>
                </div>
            </div>
            
            <!-- Chat Input -->
            <div class="border-t border-gray-100 p-3">
                <div class="flex items-center space-x-2">
                    <input id="chatInput" type="text" placeholder="Escribe tu mensaje..." class="flex-1 px-3 py-2 bg-gray-100 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-marriott-red/20">
                    <button onclick="sendChatMessage()" class="p-2 bg-marriott-red hover:bg-marriott-dark text-white rounded-lg transition-colors">
                        <i data-feather="send" class="w-4 h-4"></i>
                    </button>
                </div>
                <button onclick="requestHuman()" class="w-full mt-2 text-xs text-gray-500 hover:text-marriott-red transition-colors">
                    Solicitar asistencia humana
                </button>
            </div>
        </div>

        <!-- Human Assistant Modal -->
        <div id="humanModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-[60] animate-fade-in">
            <div class="bg-white rounded-2xl p-6 m-4 max-w-sm animate-slide-up">
                <div class="text-center">
                    <div class="w-16 h-16 bg-marriott-red/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-feather="user" class="w-8 h-8 text-marriott-red"></i>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Conectando con personal</h3>
                    <p class="text-gray-600 text-sm mb-4">Un miembro de nuestro equipo te atenderá en menos de 60 segundos</p>
                    <div class="flex items-center justify-center space-x-2 mb-6">
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                        <div class="w-2 h-2 bg-marriott-red rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                    <button onclick="closeHumanModal()" class="w-full py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="hidden fixed top-20 right-6 bg-gray-900 text-white px-4 py-3 rounded-lg shadow-lg animate-slide-up z-50">
            <div class="flex items-center space-x-2">
                <i data-feather="check-circle" class="w-5 h-5"></i>
                <span id="toastMessage">Mensaje</span>
            </div>
        </div>

    </div>

    <script>
        // API Configuration
        const API_URL = "https://vercel-proxy-ask.vercel.app/api/ask";

        // State Management
        let state = {
            currentStep: 1,
            startTime: null,
            timerInterval: null,
            totalTime: 0,
            chatOpen: false
        };

        // Start Check-in Flow
        function startCheckIn() {
            showStep(2);
            startTimer();
            simulateQRScan();
        }

        // Show QR Scanner
        function showQRScanner() {
            startCheckIn();
        }

        // Simulate QR Scanning
        function simulateQRScan() {
            setTimeout(() => {
                // Show scanned data after animation
                document.getElementById('dataPreview').classList.remove('hidden');
                document.querySelector('#step2 .text-center').classList.add('hidden');
            }, 2000);
        }

        // Confirm Check-in
        function confirmCheckIn() {
            showStep(3);
            stopTimer();
            document.getElementById('totalTime').textContent = `${state.totalTime} segundos`;
            showToast('Check-in completado exitosamente');
        }

        // Send to Phone
        function sendToPhone() {
            showToast('Llave digital enviada a tu móvil');
        }

        // Print Card
        function printCard() {
            showToast('Imprimiendo tarjeta de acceso...');
        }

        // Reset to Start
        function resetToStart() {
            state.currentStep = 1;
            state.totalTime = 0;
            stopTimer();
            
            // Reset all steps
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('dataPreview').classList.add('hidden');
            document.querySelector('#step2 .text-center').classList.remove('hidden');
            
            // Reset timer display
            document.getElementById('timerBadge').classList.add('hidden');
            document.getElementById('timerDisplay').textContent = '00:00';
        }

        // Show specific step
        function showStep(step) {
            // Hide all steps
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            
            // Show requested step
            document.getElementById(`step${step}`).classList.remove('hidden');
            
            state.currentStep = step;
            
            // Update Feather icons for new content
            if (typeof feather !== 'undefined') {
                setTimeout(() => feather.replace(), 100);
            }
        }

        // Timer functions
        function startTimer() {
            state.startTime = Date.now();
            document.getElementById('timerBadge').classList.remove('hidden');
            
            state.timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - state.startTime) / 1000);
                state.totalTime = elapsed;
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 100);
        }

        function stopTimer() {
            if (state.timerInterval) {
                clearInterval(state.timerInterval);
                state.timerInterval = null;
            }
        }

        // API Function
        async function askAPI(question) {
            const res = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question })
            });
            if (!res.ok) {
                const txt = await res.text().catch(() => "");
                throw new Error(`HTTP ${res.status} ${res.statusText}` + (txt ? ` – ${txt.slice(0,200)}` : ""));
            }
            const data = await res.json();
            return typeof data.answer === "string" ? data.answer : JSON.stringify(data, null, 2);
        }

        // Chat Functions
        function toggleChat() {
            state.chatOpen = !state.chatOpen;
            const chatWindow = document.getElementById('chatWindow');
            
            if (state.chatOpen) {
                chatWindow.classList.remove('hidden');
            } else {
                chatWindow.classList.add('hidden');
                // Reset chat when closing
                resetChat();
            }
            
            // Reinitialize icons
            if (typeof feather !== 'undefined') {
                setTimeout(() => feather.replace(), 100);
            }
        }

        function resetChat() {
            const messagesDiv = document.getElementById('chatMessages');
            // Clear all messages and reset with welcome message
            messagesDiv.innerHTML = `
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-semibold text-gray-600">AI</div>
                    <div class="bg-gray-100 rounded-xl rounded-tl-none px-3 py-2 max-w-[80%]">
                        <p class="text-sm text-gray-700">Hola, soy tu asistente de check-in. Pregúntame horarios, recomendaciones y dudas generales.</p>
                    </div>
                </div>
            `;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Add thinking message
            const thinkingMsg = addThinkingMessage();
            
            try {
                // Get real response from API
                const answer = await askAPI(message);
                
                // Remove thinking message
                thinkingMsg.remove();
                
                // Add bot response
                addMessage(answer, 'bot');
            } catch (err) {
                // Remove thinking message
                thinkingMsg.remove();
                
                // Show error message
                addMessage('Lo siento, ocurrió un error al procesar tu consulta. Por favor, intenta de nuevo o solicita asistencia humana.', 'bot');
                console.error('Error en chat:', err);
            }
        }

        function addThinkingMessage() {
            const messagesDiv = document.getElementById('chatMessages');
            
            const thinkingHTML = `
                <div class="flex items-start space-x-2 thinking-message">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-semibold text-gray-600">AI</div>
                    <div class="bg-gray-100 rounded-xl rounded-tl-none px-3 py-2">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesDiv.innerHTML += thinkingHTML;
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return messagesDiv.querySelector('.thinking-message');
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            
            const messageHTML = sender === 'user' 
                ? `<div class="flex items-start justify-end space-x-2">
                    <div class="bg-marriott-red text-white rounded-xl rounded-tr-none px-3 py-2 max-w-[80%]">
                        <p class="text-sm">${text}</p>
                    </div>
                    <div class="w-8 h-8 bg-green-100 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-semibold text-green-700">TÚ</div>
                   </div>`
                : `<div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex-shrink-0 flex items-center justify-center text-xs font-semibold text-gray-600">AI</div>
                    <div class="bg-gray-100 rounded-xl rounded-tl-none px-3 py-2 max-w-[80%]">
                        <p class="text-sm text-gray-700">${text}</p>
                    </div>
                   </div>`;
            
            messagesDiv.innerHTML += messageHTML;
            
            // Auto-scroll to bottom with smooth behavior
            setTimeout(() => {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 100);
        }

        // Human Assistant
        function requestHuman() {
            document.getElementById('humanModal').classList.remove('hidden');
            if (typeof feather !== 'undefined') {
                setTimeout(() => feather.replace(), 100);
            }
        }

        function closeHumanModal() {
            document.getElementById('humanModal').classList.add('hidden');
        }

        // Toast Notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (state.chatOpen) {
                    toggleChat();
                }
                if (!document.getElementById('humanModal').classList.contains('hidden')) {
                    closeHumanModal();
                }
            }
        });

        // Enter key for chat
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Feather Icons if available
            if (typeof feather !== 'undefined') {
                feather.replace();
            }
            
            // Fallback: If icons don't load, use text
            setTimeout(() => {
                if (typeof feather === 'undefined') {
                    console.log('Feather icons not loaded, using fallback');
                    // Replace icon placeholders with text symbols
                    document.querySelectorAll('[data-feather]').forEach(el => {
                        el.innerHTML = '•';
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html>